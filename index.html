<!DOCTYPE html>
<html lang="es">
    <head>
        <title>GNC App - Test</title>
    </head>
    <body>
        <h1>GNC App - Test</h1>
        <h2>Nuevo registro</h2>
        <form>
            <label for="txtDate">Fecha</label>
            <input type="text" id="txtDate" class="data-entry" />
            <label for="txtKm">Kilometraje</label>
            <input type="text" id="txtKm" class="data-entry" />
            <label for="txtUnidad">Unidad</label>
            <input type="text" id="txtUnidad"  class="data-entry" />
            <label for="txtTotal">Total</label>
            <input type="text" id="txtTotal"  class="data-entry" />
            <button id="btnCargar">Cargar</button>
        </form>
        <h2>Registro anteriores</h2>
        <table>
            <thead>
                <tr>
                    <th>Fecha</th>
                    <th>Kilometraje</th>
                    <th>Unidad</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody id="tblRegistro">
                
            </tbody>
        </table>
    </body>
    <script>
        var $ = function(query) { 
            var els = document.querySelectorAll(query);
            if(els.length === 1) {
                return els[0];
            } else {
                return els;
            }
            return [];
        };
        var storage = null;
        var dataEntrySelector = [];
        var els = $(".data-entry");
        for(var i = 0; i < els.length; i++) {
            dataEntrySelector.push(els[i].getAttribute("id"));
        }
        console.log(dataEntrySelector);
        document.addEventListener( "DOMContentLoaded", function() {
            storage = JSON.parse(localStorage.getItem('carapp.registros'));
            if(storage === null || storage === '') {
                var storage = [];
                localStorage.setItem('carapp.registros', JSON.stringify(storage));
            } else {
                storage = JSON.parse(localStorage.getItem('carapp.registros'));
                for (var i = 0; i < storage.length; i++) {
                    var _data = ""; 
                    for(var j = 0; j < dataEntrySelector.length; j++) {
                        _data += "<td>" + storage[i][dataEntrySelector[j]] + "</td>";
                    }
                    document.getElementById('tblRegistro').innerHTML += "<tr>" + _data + "</tr>";    
                }
            }
            document.getElementById('btnCargar').addEventListener('touchstart', function (event) {
                event.preventDefault();
                storage = localStorage.getItem('carapp.registros');
                storage = JSON.parse(storage);
                var registro = {};
                for(var i = 0; i < dataEntrySelector.length; i++) {
                    registro[dataEntrySelector[i]] = $("#" + dataEntrySelector[i]).value;
                }
                console.log(registro);
                storage.push(registro);
                localStorage.setItem('carapp.registros', JSON.stringify(storage));
                var _data = ""; 
                for(var j = 0; j < dataEntrySelector.length; j++) {
                    _data += "<td>" + registro[dataEntrySelector[j]] + "</td>";
                }
                document.getElementById('tblRegistro').innerHTML += "<tr>" + _data + "</tr>";    
            }, false);
        }, false);
    </script>
</html>
