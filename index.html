<!DOCTYPE html>
<html lang="es">
    <head>
        <title>GNC App - Test</title>
    </head>
    <body>
        <h1>GNC App - Test</h1>
        <h2>Nuevo registro</h2>
        <form>
            <label for="txtDate">Fecha</label>
            <input type="text" id="txtDate" class="data-entry" />
            <label for="txtKm">Kilometraje</label>
            <input type="text" id="txtKm" class="data-entry" />
            <label for="txtUnidad">Unidad</label>
            <input type="text" id="txtUnidad"  class="data-entry" />
            <label for="txtTotal">Total</label>
            <input type="text" id="txtTotal"  class="data-entry" />
            <div><button id="btnCargar">Cargar</button></div>
        </form>
        <h2>Registro anteriores</h2>
        <table>
            <thead>
                <tr>
                    <th>Fecha</th>
                    <th>Kilometraje</th>
                    <th>Unidad</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody id="tblRegistro"></tbody>
        </table>
    </body>
    <script src="cordova.js" type="text/javascript"></script>
    <script src="lib/jquery.js"></script>
    <script>
        // Wait for Apache Cordova to load
        document.addEventListener("deviceready", onDeviceReady, false);
        // PhoneGap is ready
        function onDeviceReady() {
            //alert("device ready");
            var storage = null;
            var dataEntrySelector = [];
            var els = $(".data-entry");
            for(var i = 0; i < els.length; i++) {
                dataEntrySelector.push(els.get(i).getAttribute("id"));
            }
            $(document).ready(function(){
                storage = JSON.parse(window.localStorage.getItem('carapp.registros'));
                if(storage === null || storage === '') {
                    var storage = [];
                    window.localStorage.setItem('carapp.registros', JSON.stringify(storage));
                } else {
                    storage = JSON.parse(window.localStorage.getItem('carapp.registros'));
                    for (var i = 0; i < storage.length; i++) {
                        var _data = ""; 
                        for(var j = 0; j < dataEntrySelector.length; j++) {
                            _data += "<td>" + storage[i][dataEntrySelector[j]] + "</td>";
                        }
                        $('#tblRegistro').html($('#tblRegistro').html() + "<tr>" + _data + "</tr>");    
                    }
                }
                $("#btnCargar").click(function(event){
                    event.preventDefault();
                    storage = window.localStorage.getItem('carapp.registros');
                    storage = JSON.parse(storage);
                    var registro = {};
                    for(var i = 0; i < dataEntrySelector.length; i++) {
                        registro[dataEntrySelector[i]] = $("#" + dataEntrySelector[i]).val();
                    }
                    storage.push(registro);
                    window.localStorage.setItem('carapp.registros', JSON.stringify(storage));
                    var _data = ""; 
                    for(var j = 0; j < dataEntrySelector.length; j++) {
                        _data += "<td>" + registro[dataEntrySelector[j]] + "</td>";
                    }
                    $('#tblRegistro').html($('#tblRegistro').html() + "<tr>" + _data + "</tr>");   
                });    
            });
        }
        
    </script>
</html>
